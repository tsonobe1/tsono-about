---
title: 'TDDを実践してみて感じたこと'
date: '2026-01-09'
updatedAt: '2026-01-09'
kind: 'essay'
tags:
  - life
  - routine
summary: '在宅でもスイッチを切り替えるための朝の習慣メモ。'
---

マインドマップのアプリをTDDで作成しています。
私にとってのTDD及びテストコードを書きながらの実装は、本アプリが初でした。
実践前に、以下動画を参考にしています。

https://www.youtube.com/live/Q-FJ3XmFlT8?t=2515&si=Kw7gGkyqHJb6sDZN

# TODOリスト作成でテスト容易性・重要性を意識すると責務がきれいになる

TDDの最初のステップとして、システムが満たすべき要件を列挙していきます。

例: マインドマップのノード操作

```
- [ ] ノードをクリックすることで選択状態になる
- [ ] ノードを選択状態で Tabキー を押下することで、子ノードを追加する
- [ ] ノードを選択状態で Enterキー を押下することで、兄弟ノードを追加する
- [ ] ノードを選択状態で Deleteキー を押下することで、対象ノードを削除する
- [ ] ルートノードを選択状態で Enterキー を押下しても、兄弟ノードが追加されない
...etc
```

思いつく限り列挙した後、テスト容易性・重要性を高めるようブラッシュアップします。
このステップでは、先程の動画のTODOリスト作成のフェーズを何度も参考にしました。
https://www.youtube.com/live/Q-FJ3XmFlT8?t=2515&si=Kw7gGkyqHJb6sDZN

ここでいうブラッシュアップは、TODOリストから テストしにくい要素（入出力やUI操作）を切り離して表現し直していくことです。
すると、以下のように表現できます。

```
- [ ] ルートノードに対する追加・削除操作
  - [ ] ルートノードを選択状態にできる
  - [ ] ルートノードを解除状態にできる
  - [ ] 選択状態を変更したとき、更新日時はこうしんしない
  - [ ] 子ノードを新規追加できる
  - [ ] 兄弟ノードを新規追加できない
  - [ ] 削除できない
- [ ] 通常ノードに対する追加・削除操作
  - [ ] 選択状態にできる
  - [ ] 解除状態にできる
  - [ ] 対象ノードの子ノードを新規作成できる
  - [ ] 対象ノードの兄弟ノードを新規作成できる
  - [ ] 対象ノードを削除できる
... etc
```

この作業で気がついたのは「このTODOはドメインロジックじゃないか？」ということです。
私は `Vue.js` の `CompositionAPI` を利用しているので、ノード操作のロジックを`useNode`という`Composables`に閉じ込め、上記の状態と操作をTDDで実装していきました。
（途中で気がついたことをTODOリストに反映しながら）

TDDの良さは様々な書籍で語られていますが、私は実践していて特に嬉しかったのは、テスト可能なTODを作成する過程でUIとロジックの責務を強制的に切り離さざるを得なくなるということです。

特に身にしみたのは、本アプリをTDDで開発する前に一度バイブコーディングである程度まで作成していったからです。
UIとビジネスロジックがコンポーネントに混じり、ソフトウェアのエントロピーが増大していってしまったので、限界を感じていたときに出会ったのがTDDでした。

## ドメインロジックをどのくらい防御的に書いたら良いのかという感覚

ノード操作のドメインロジックを作成しているとき、早期リターンなどをどれくらい設ければよいのか？という指針を探していました。
そのときに出会った文献です
https://gihyo.jp/news/report/01/phpcon2016/0002
https://qiita.com/yoshitaro-yoyo/items/bb8cc631276380b68c13#1-猜疑心か相互信頼か防御的か契約に基づくか))も参考にすると

予防的プログラミングは常に意識しつつ、
UI層に近いほど防御的プログラミング、ドメイン層に近いほど契約プログラミングであることを心がけるという指針になった。

`useNode`では、例外にはエラーをスローするようにしたし、ありえない値への対処はしないようにした。
この学びは仕事でも生きている。仕事のプロジェクトでは `MVC + S`を採用している。
レビュー中に`S`の深いところで else == 引数がfalsy で空文字をリターンしているコードを見つけた。
コードを読むと、falsy な値が入ってくることはなく、かつ空文字をリターンすると後続処理がバグることが確定していた。
else句を書かないと文法規約で警告が出るため、 エラーをスローすることで前処理にバグがあることを表現し、バグの対応も素早くできるよというレビューができた。

# 単体テストの考え方/使い方を読んで

## テストケースの3Aをスペースで区切る

準備・実行・検証を視覚的に明確にするためにスペースで区切る方法が挙げられていましたが、自然とできていました

## 共通のテストフィクスチャはファクトリ関数にすると読みやすい

beforeEachで事前実行するより、ファクトリ関数にして準備ケースで実行するようにすると読みやすいという話
本書にあがっていたが、実践をしていた
